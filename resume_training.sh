#!/bin/bash
# Скрипт для продолжения обучения модели с 15-й эпохи
#
# Примечание: При использовании --resume, параметр --epochs означает
# ОБЩЕЕ количество эпох, до которого нужно обучить модель.
# Например, если обучение остановилось на 15-й эпохе, и вы хотите
# обучить еще 30 эпох (до 45-й), укажите --epochs 45

cd "$(dirname "$0")"

# Путь к чекпоинту (последний сохраненный чекпоинт с 15-й эпохи)
CHECKPOINT="training_results/run_default_15ep2/weights/last.pt"

# Проверка наличия чекпоинта
if [ ! -f "$CHECKPOINT" ]; then
    echo "Ошибка: Чекпоинт не найден: $CHECKPOINT"
    exit 1
fi

echo "=========================================="
echo "Продолжение обучения с чекпоинта:"
echo "$CHECKPOINT"
echo "=========================================="
echo ""

# Активация виртуального окружения
if [ -d "venv" ]; then
    source venv/bin/activate
    echo "✓ Виртуальное окружение активировано"
fi

# Переход в директорию с тренировочным скриптом
cd project_yolo

# Параметры обучения
# TOTAL_EPOCHS: Общее количество эпох (текущая 15 + дополнительные)
# Например: если хотите обучить еще 30 эпох, укажите 45 (15 + 30)
TOTAL_EPOCHS=${1:-45}  # По умолчанию 45 эпох (еще 30 после 15-й)

echo "Будет обучено до ${TOTAL_EPOCHS} эпох (продолжение с 15-й)"
echo ""

# Запуск обучения с продолжением
# Используем новое имя для отдельного трека результатов
python train.py \
    --data ../merged_dataset/dataset.yaml \
    --resume ../$CHECKPOINT \
    --epochs $TOTAL_EPOCHS \
    --imgsz 640 \
    --batch 1 \
    --project ../training_results \
    --name run_default_15ep2_continued \
    --config configs/training.yaml

echo ""
echo "=========================================="
echo "Обучение завершено!"
echo "=========================================="

